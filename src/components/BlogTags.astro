---
import { countItems, sortByValue, getAllPosts } from "@js/blogUtils";

const posts = await getAllPosts();
const allTags = posts
	.map((post) => post.data.tags)
	.filter((tags) => tags !== undefined && tags !== null)
	.flat()
	.filter((tag) => tag !== undefined && tag !== null && tag !== "");
const countedTags = countItems(allTags as string[]);
const processedTags = sortByValue(countedTags);

interface Props {
	showCount?: boolean;
}

const { showCount = false } = Astro.props as Props;
---

<div class="tags-widget">
	<h3 class="mb-4 text-lg font-semibold">Tags</h3>
	<div class="flex flex-wrap gap-2">
		{
			processedTags.map(([tag, count]) => (
				<a
					href={`/tags/${tag}`}
					class="mr-2 mb-2 inline-block rounded-full bg-gray-200 px-3 py-1 text-sm font-semibold text-gray-700 hover:bg-gray-300"
				>
					#{tag}
					{showCount && ` (${count})`}
				</a>
			))
		}
	</div>
</div>
